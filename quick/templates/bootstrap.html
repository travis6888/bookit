{% load staticfiles %}
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <!--jquery files-->
    <script src="{% static 'js/jquery-1.11.1.min.js' %}"></script>

    <!--bootstrap js file-->
    <script src="{% static 'js/bootstrap.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>

    <!--bootstrap css-->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/thumbnail-gallery.css' %}" rel="stylesheet">
{#    <link href="{% static 'css/simple-sidebar.css' %}" rel="stylesheet">#}
    <link href="{% static 'css/stylish-portfolio.css' %}" rel="stylesheet">



    <!--CSS files-->


    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <style type="text/css">
        html {
            height: 100%
        }

        body {
            height: 100%;
            margin: 0;
            padding: 0
        }

        #map-canvas {
            height: 100%
        }
    </style>
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCmXQO4kik_QT8QPmzZ2_teiGUak9t1rQc">
    </script>
{#    <script src="{% static 'js/maps.js' %}"></script>#}
<body>
<a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
    <nav id="sidebar-wrapper">
        <ul class="sidebar-nav">
            <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
            <li class="sidebar-brand">
         <li class="sidebar-brand">
                    <a href="#">
                        BookIt
                    </a>
                    <li>
                 {% if not user.is_authenticated %}
                        <a href="{% url "social:begin" "google-oauth2" %}">Google Login</a>
                    {% else %}
                        Hi {{ user.username }}! | <a href="{% url 'profile' %}">Profile Page</a>
                    {% endif %}
                </li>
                {% for key, values in matched.items %}

                    {% if values|length > 0 %}
                        <li>
                            <a href="#{{ key }}">{{ key| lower| capfirst }}</a>

                        </li>
                    {% endif %}
                {% endfor %}
            </ul>
    </nav>
{#    <div class="container">#}
{#        <section id="contact" class="map">#}
{#            <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"#}
{#                    src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=Twitter,+Inc.,+Market+Street,+San+Francisco,+CA&amp;aq=0&amp;oq=twitter&amp;sll=28.659344,-81.187888&amp;sspn=0.128789,0.264187&amp;ie=UTF8&amp;hq=Twitter,+Inc.,+Market+Street,+San+Francisco,+CA&amp;t=m&amp;z=15&amp;iwloc=A&amp;output=embed"></iframe>#}
{#            <br/>#}
{#            <small>#}
{#                <a href="https://maps.google.com/maps?f=q&amp;source=embed&amp;hl=en&amp;geocode=&amp;q=Twitter,+Inc.,+Market+Street,+San+Francisco,+CA&amp;aq=0&amp;oq=twitter&amp;sll=28.659344,-81.187888&amp;sspn=0.128789,0.264187&amp;ie=UTF8&amp;hq=Twitter,+Inc.,+Market+Street,+San+Francisco,+CA&amp;t=m&amp;z=15&amp;iwloc=A"></a>#}
{#            </small>#}
{#            </iframe>#}
{#        </section>#}
{#    </div>#}

{#    <div class="mapDiv">#}
{#    </div>#}
    <div class="container">
        <section id="contact" class="map">
            <div id="map-canvas"></div>
        </section>
    </div>
    <div class="container">
        <div class="row">
            <div class="events">


                <div class="event">

                    {% for key, values in matched.items %}

                        {% if values|length > 0 %}
                            <div class="row eventGrid" id="{{ key }}" style="border: 1px solid #000000;">

                            <h3>{{ key| lower| capfirst }}</h3>
                        {% endif %}

                    {% for  event in values %}
                        <div class="col-lg-2  col-md-4 col-xs-6 thumb center-block">
                            <p>Title {{ event.name }}</p>

                            <p>Category {{ event.category| lower| capfirst }}</p>

                            <p>Venue {{ event.venue }}</p>

                            <p>Starts at: {{ event.start_dateTime| date:"DATETIME_FORMAT" }}</p>

                            <p>Ends at: {{ event.end_dateTime| date:"DATETIME_FORMAT" }}</p>
                        </div>
                    {% endfor %}
                    </div>


                    {% endfor %}

                </div>

            </div>
        </div>
    </div>

<script>

    var map;
    function initialize() {
        var mapDiv = document.getElementById('map-canvas');
        map = new google.maps.Map(mapDiv, {
            center: new google.maps.LatLng(37.7833, -122.4167),
            zoom: 12,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        google.maps.event.addListenerOnce(map, 'tilesloaded', addMarkers);

    }

   function addMarkers() {
      {% for key, values in matched.items %}
        {% for event in values %}
            var point = new google.maps.LatLng({{event.latitude}},{{event.longitude}});
{#                var image = '{{ STATIC_PREFIX }}'+ 'checkmark.png';#}
                var marker = new google.maps.Marker({
                position: point,
                map: map,
{#                icon: image, #}
{#                url: 'http://172.16.0.101:8882/zone/' + {{mark.id}},#}
               title: '{{ event.name }}',
            });
             marker['infowindow']  = new google.maps.InfoWindow({
                     content: "<h1>{{event.name}}</h1> <p>{{ event.start_time }} {{ event.end_time }}</p><p><a href={{ event.event_url }}>Event Site</a></p>"
        });
            google.maps.event.addListener(marker, 'click', function() {
                //window.location.href = this.url;
                 this['infowindow'].open(map, this);
            });
           google.maps.event.addListener(marker, 'mouseover', function() {
                // this['infowindow'].open(map, this);
                    });
           google.maps.event.addListener(marker, 'mouseout', function() {
                // this['infowindow'].close(map, this);

            });





        {% endfor %}
   {% endfor %}

  }



    google.maps.event.addDomListener(window, 'load', initialize);
</script>

</body>
</html>